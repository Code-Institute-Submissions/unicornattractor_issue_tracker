{% extends 'base.html' %} {% load static from staticfiles %} {% block page_title %} Data Dashboard {% endblock %} {% block content %}

<!-- Page content container (BEGINNING) -->
<section class="content-container">
  <div id="dashboard-page" class="container-fluid pt-5 pb-3 px-sm-5 px-3 bgr-off-white">

    <!-- Dashboard section containing three tiles with summary statistics (BEGINNING) -->
    <section id="summary-stats">
      <div class="container-fluid">
        <div class="row">

          <!-- Total tickets tile -->
          <div class="col-lg-4 col-md-4 col-sm-12 px-2">
            <div id="total-tickets-card" class="card mb-3">
              <div class="card-header bg-dark text-white text-uppercase">Total Tickets</div>
              <div class="card-body">
                <div class="row no-gutters">

                  <!-- Total number of tickets (BEGINNING) -->
                  <div class="col mt-auto mb-0 ml-4 text-dark summary-figure">
                    {{ total_tickets }}
                  </div>
                  <!-- Total number of tickets (END) -->

                  <!-- SVG Spark Lines serving as decoration for the summary stats tile (BEGINNING) -->
                  <div class="col-auto text-primary">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="chart" fill="#fcd731" viewBox="0 0 70 20" height="40" width="100" role="img">
                      <g class="bar" transform="translate(0,0)"><rect height="4" y="16" width="5"></rect></g>
                      <g class="bar" transform="translate(6,0)"><rect height="6" y="14" width="5"></rect></g>
                      <g class="bar" transform="translate(12,0)"><rect height="5" y="15" width="5"></rect></g>
                      <g class="bar" transform="translate(18,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(24,0)"><rect height="9" y="11" width="5"></rect></g>
                      <g class="bar" transform="translate(30,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(36,0)"><rect height="16" y="4" width="5"></rect></g>
                      <g class="bar" transform="translate(42,0)"><rect height="17" y="3" width="5"></rect></g>
                      <g class="bar" transform="translate(48,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(54,0)"><rect height="9" y="11" width="5"></rect></g>
                      <g class="bar" transform="translate(60,0)"><rect height="5" y="15" width="5"></rect></g>
                      <g class="bar" transform="translate(66,0)"><rect height="2" y="18" width="5"></rect></g>
                  </svg>
                  </div>
                  <!-- SVG Spark Lines serving as decoration for the summary stats tile (END) -->

                </div>
              </div>
            </div>
          </div>

          <!-- Total bugs tile -->
          <div class="col-lg-4 col-md-4 col-sm-12 px-2">
            <div id="total-bugs-card" class="card mb-3">
              <div class="card-header bg-dark text-white text-uppercase">Total Reported Bugs</div>
              <div class="card-body">
                <div class="row no-gutters">

                  <!-- Total number of bugs (BEGINNING) -->
                  <div class="col mt-auto mb-0 ml-4 text-dark summary-figure">
                    {{ total_bugs}}
                  </div>
                  <!-- Total number of bugs (END) -->

                  <!-- SVG Spark Lines serving as decoration for the summary stats tile (BEGINNING) -->
                  <div class="col-auto text-primary">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="chart" fill="#ef6354" viewBox="0 0 70 20" height="40" width="100" role="img">
                      <g class="bar" transform="translate(0,0)"><rect height="4" y="16" width="5"></rect></g>
                      <g class="bar" transform="translate(6,0)"><rect height="6" y="14" width="5"></rect></g>
                      <g class="bar" transform="translate(12,0)"><rect height="5" y="15" width="5"></rect></g>
                      <g class="bar" transform="translate(18,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(24,0)"><rect height="9" y="11" width="5"></rect></g>
                      <g class="bar" transform="translate(30,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(36,0)"><rect height="16" y="4" width="5"></rect></g>
                      <g class="bar" transform="translate(42,0)"><rect height="17" y="3" width="5"></rect></g>
                      <g class="bar" transform="translate(48,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(54,0)"><rect height="9" y="11" width="5"></rect></g>
                      <g class="bar" transform="translate(60,0)"><rect height="5" y="15" width="5"></rect></g>
                      <g class="bar" transform="translate(66,0)"><rect height="2" y="18" width="5"></rect></g>
                  </svg>
                  </div>
                  <!-- SVG Spark Lines serving as decoration for the summary stats tile (END) -->

                </div>
              </div>
            </div>
          </div>

          <!-- Total features tile -->
          <div class="col-lg-4 col-md-4 col-sm-12 px-2">
            <div id="total-features-card" class="card mb-3">
              <div class="card-header bg-dark text-white text-uppercase">Total Proposed Features</div>
              <div class="card-body">
                <div class="row no-gutters">

                  <!-- Total number of features (BEGINNING) -->
                  <div class="col mt-auto mb-0 ml-4 text-dark summary-figure">
                    {{ total_features }}
                  </div>
                  <!-- Total number of features (END) -->

                  <!-- SVG Spark Lines serving as decoration for the summary stats tile (BEGINNING) -->
                  <div class="col-auto text-primary">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="chart" fill="#63d37b" viewBox="0 0 70 20" height="40" width="100" role="img">
                      <g class="bar" transform="translate(0,0)"><rect height="4" y="16" width="5"></rect></g>
                      <g class="bar" transform="translate(6,0)"><rect height="6" y="14" width="5"></rect></g>
                      <g class="bar" transform="translate(12,0)"><rect height="5" y="15" width="5"></rect></g>
                      <g class="bar" transform="translate(18,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(24,0)"><rect height="9" y="11" width="5"></rect></g>
                      <g class="bar" transform="translate(30,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(36,0)"><rect height="16" y="4" width="5"></rect></g>
                      <g class="bar" transform="translate(42,0)"><rect height="17" y="3" width="5"></rect></g>
                      <g class="bar" transform="translate(48,0)"><rect height="10" y="10" width="5"></rect></g>
                      <g class="bar" transform="translate(54,0)"><rect height="9" y="11" width="5"></rect></g>
                      <g class="bar" transform="translate(60,0)"><rect height="5" y="15" width="5"></rect></g>
                      <g class="bar" transform="translate(66,0)"><rect height="2" y="18" width="5"></rect></g>
                  </svg>
                  </div>
                  <!-- SVG Spark Lines serving as decoration for the summary stats tile (END) -->

                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </section>
    <!-- Dashboard section containing three tiles with summary statistics (END) -->

    <!-- Dashboard section containing analysis of tickets by type, status, and number of upvotes (BEGINNING) -->
    <section id="charts-stats">
      <div class="container-fluid">
        <div class="row">

          <!-- Tickets by type pie chart tile (BEGINNING) -->
          <div class="col-lg-4 col-md-4 col-sm-12 px-2">
            <div id="tickets-type-card" class="card mb-3">
              <div class="card-header bg-dark text-white text-uppercase">Tickets by type</div>
              <div class="card-body">

                <figure class="highcharts-figure">
                  <div id="ticket-type-chart"></div>
                </figure>

              </div>
            </div>
          </div>
          <!-- Tickets by type pie chart tile (END) -->

          <!-- Tickets by type and status stacked chart tile (BEGINNING) -->
          <div class="col-lg-4 col-md-4 col-sm-12 px-2">
            <div id="tickets-status-card" class="card mb-3">
              <div class="card-header bg-dark text-white text-uppercase">Tickets by type and status</div>
              <div class="card-body">

                <figure class="highcharts-figure">
                  <div id="ticket-status-chart"></div>
                </figure>

              </div>
            </div>
          </div>
          <!-- Tickets by type and status stacked chart tile (END) -->

          <!-- Tickets by the highest number of upvotes tile (BEGINNING) -->
          <div class="col-lg-4 col-md-4 col-sm-12 px-2">
            <div id="tickets-upvotes-card" class="card mb-3">
              <div class="card-header bg-dark text-white text-uppercase">Top upvoted tickets</div>
              <div class="card-body">

              </div>
            </div>
          </div>
          <!-- Tickets by the highest number of upvotes tile (END) -->

        </div>
      </div>
    </section>
    <!-- Dashboard section containing analysis of tickets by type, status, and number of upvotes (END) -->

  </div>
</section>
<!-- Page content container (END) -->
{% endblock %}

{% block graph_js %}
<script>

$(document).ready(function() {
  
  // PIE CHART

/**
 * Highcharts pie chart presenting ticket by type breakdown.
 * When clicking on a slice user is able to investigate further details
 * i.e. further breakdown of ticket type by the status.
 **/
 
  /* Pie chart values variables */
  let total_open_bugs = {{ total_open_bugs | safe }};
  let total_in_progress_bugs = {{ total_in_progress_bugs | safe }};
  let total_completed_bugs = {{ total_completed_bugs | safe }};
  let total_closed_bugs = {{ total_closed_bugs | safe }};
  
  let total_open_features = {{ total_open_features | safe }};
  let total_in_progress_features = {{ total_in_progress_features | safe }};
  let total_completed_features = {{ total_completed_features | safe }};
  let total_closed_features = {{ total_closed_features | safe }};

  chart = new Highcharts.chart('ticket-type-chart', {
    chart: {
      type: 'pie'
    },
    title: {
      style: {
        display: 'none'
      }
    },
    subtitle: {
      text: 'Click the slices to view tickets by status',
    },
    credits: {
      enabled: false
    },
    accessibility: {
      announceNewData: {
        enabled: true
      },
      point: {
        valueSuffix: '%'
      }
    },
    plotOptions: {
      series: {
        dataLabels: {
          enabled: false,
        },
        showInLegend: true,
      }
    },
    tooltip: {
      headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
      pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
    },
    colors: ['#63d37b', '#fcd731', '#ef6354', '#2e3190', '#88fca1', '#fceb9f', '#fcdcd7', '#494de3', '#ee5140'],
    series: [{
      name: "Tickets",
      colorByPoint: true,
      data: [{
          name: "Bugs",
          y: 62.74,
          drilldown: "Bugs"
        },
        {
          name: "Features",
          y: 10.57,
          drilldown: "Features"
        }
      ]
    }],
    drilldown: {
      series: [{
          name: "Bugs",
          id: "Bugs",
          data: [
            [
              "Open",
              total_open_bugs
            ],
            [
              "In progress",
              total_in_progress_bugs
            ],
            [
              "Completed",
              total_completed_bugs
            ],
            [
              "Closed",
              total_closed_bugs
            ]
          ]
        },
        {
          name: "Features",
          id: "Features",
          data: [
            [
              "Open",
              total_open_features
            ],
            [
              "In progress",
              total_in_progress_features
            ],
            [
              "Completed",
              total_completed_features
            ],
            [
              "Closed",
              total_closed_features
            ]
          ]
        }
      ],

      drillUpButton: {
        position: {
          verticalAlign: top,
          x: 0,
          y: 5
        },
        theme: undefined
      }
    },
    lang: {
      drillUpText: '< Back'
    },
    exporting: {
      buttons: {
        contextButton: {
          align: 'right',
          x: 5
        }
      }
    }
  });
  
  
  // STACKED CHART

chart = new  Highcharts.chart('ticket-status-chart', {
  chart: {
    type: 'column'
  },
  title: {
    style: {
        display: 'none'
      }
  },
  credits: {
      enabled: false
    },
  xAxis: {
    categories: ['Bugs', 'Features']
  },
  yAxis: {
    min: 0,
    title: {
      text: 'Total number of tickets'
    }
  },
  tooltip: {
    pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.percentage:.0f}%)<br/>',
    shared: true
  },
  plotOptions: {
    column: {
      stacking: 'percent'
    }
  },
  colors: ['#63d37b', '#fcd731', '#ef6354', '#2e3190', '#88fca1', '#fceb9f', '#fcdcd7', '#494de3', '#ee5140'],
  series: [{
    name: 'Open',
    data: [ total_open_bugs, total_open_features]
  }, {
    name: 'In Progress',
    data: [total_in_progress_bugs, total_in_progress_features]
  }, {
    name: 'Completed',
    data: [total_completed_bugs, total_completed_features]
  },{
    name: 'Closed',
    data: [total_closed_bugs, total_closed_features]
  } ]
});
  
});

</script>
{% endblock %}
